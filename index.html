<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timez37 æ•°æ®è‡ªåŠ¨è¡¨æ ¼</title>
    <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.0/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { font-size: 20px; color: #1a73e8; margin-top: 0; }
        
        /* æ‰‹æœºç«¯ä¼˜åŒ–çš„ä¸Šä¼ åŒºåŸŸ */
        .upload-box {
            border: 2px dashed #1a73e8;
            background: #e8f0fe;
            border-radius: 8px;
            padding: 30px 10px;
            text-align: center;
            color: #1a73e8;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .btn-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        button { 
            flex: 1; min-width: 100px; padding: 10px; 
            border: none; border-radius: 6px; 
            background: #1a73e8; color: white; font-weight: bold;
        }
        
        #data-table { border-radius: 8px; overflow: hidden; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ“Š è‡ªåŠ¨åŒ–æ•°æ®è¡¨æ ¼</h1>
    
    <div class="upload-box" onclick="document.getElementById('file-input').click()">
        ç‚¹å‡»è¿™é‡Œé€‰æ‹©æœ¬åœ° Excel æˆ– CSV æ–‡ä»¶
        <input type="file" id="file-input" hidden accept=".xlsx, .xls, .csv">
    </div>

    <div class="btn-group">
        <button onclick="downloadCSV()">å¯¼å‡ºä¸º CSV</button>
        <button onclick="clearTable()" style="background:#ea4335;">æ¸…ç©ºè¡¨æ ¼</button>
    </div>

    <div id="data-table"></div>
</div>

<script>
    var table;

    // 1. åˆå§‹åŒ–è¡¨æ ¼é…ç½®
    table = new Tabulator("#data-table", {
        height: "500px", // è¡¨æ ¼é«˜åº¦
        layout: "fitColumns", // åˆ—å®½è‡ªé€‚åº”
        placeholder: "ç­‰å¾…ä¸Šä¼ æ•°æ®...", // ç©ºæ•°æ®æ—¶æ˜¾ç¤º
        autoColumns: true, // æ ¸å¿ƒï¼šæ ¹æ®ä¸Šä¼ çš„æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆè¡¨å¤´
        pagination: "local", // æœ¬åœ°åˆ†é¡µ
        paginationSize: 15,
        movableColumns: true, // å…è®¸æ‹–åŠ¨åˆ—
    });

    // 2. ç›‘å¬æ–‡ä»¶ä¸Šä¼ 
    document.getElementById('file-input').addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(e) {
            var data = new Uint8Array(e.target.result);
            var workbook = XLSX.read(data, {type: 'array'});
            
            // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
            var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            // è½¬åŒ–ä¸º JSON æ•°ç»„
            var json = XLSX.utils.sheet_to_json(firstSheet);
            
            if (json.length > 0) {
                // å°†æ•°æ®è½½å…¥è¡¨æ ¼
                table.setData(json);
                alert("åŠ è½½æˆåŠŸï¼å·²å¤„ç† " + json.length + " è¡Œæ•°æ®");
            } else {
                alert("æ–‡ä»¶æ˜¯ç©ºçš„æˆ–æ ¼å¼ä¸æ­£ç¡®");
            }
        };
        reader.readAsArrayBuffer(file);
    });

    // 3. å¯¼å‡ºåŠŸèƒ½
    function downloadCSV() {
        table.download("csv", "my_data.csv");
    }

    // 4. æ¸…ç©ºåŠŸèƒ½
    function clearTable() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ")) {
            table.clearData();
        }
    }
</script>

</body>
</html>
