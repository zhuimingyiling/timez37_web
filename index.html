<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.01, maximum-scale=2.0, user-scalable=yes">
    <title>WPS-WEB å°çª—å£åŠå…¬ç‰ˆ</title>
    
    <link href="https://cdn.staticfile.org/tabulator/5.1.0/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/tabulator/5.1.0/js/tabulator.min.js"></script>
    <script src="https://cdn.staticfile.org/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.staticfile.org/PapaParse/5.3.1/papaparse.min.js"></script>
    
    <style>
        :root { --primary-color: #d32f2f; --vip-gold: #ffc107; --bg-color: #f0f2f5; --border-color: #e0e0e0; }
        
        body, html { height: 100%; margin: 0; padding: 0; font-family: "Segoe UI", system-ui, sans-serif; background: var(--bg-color); overflow: hidden; }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .app-header { 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; height: 50px; 
            border-bottom: 1px solid var(--border-color); background: #ffffff;
            position: sticky; top: 0; z-index: 1000;
        }

        .main-controls { display: flex; align-items: center; gap: 8px; }
        .logo { font-weight: bold; color: var(--primary-color); font-size: 18px; margin-right: 15px; }

        .btn { border: 1px solid var(--border-color); padding: 6px 14px; border-radius: 4px; cursor: pointer; font-size: 13px; background: white; transition: 0.2s; }
        .btn-vip { background: var(--vip-gold); border: none; font-weight: bold; color: #5d4037; }
        .btn-primary { background: var(--primary-color); color: white; border: none; }

        /* ä¾§è¾¹åŠŸèƒ½é¢æ¿ */
        .vip-side-panel {
            position: fixed; top: 50px; right: -260px; bottom: 0; width: 250px;
            background: white; border-left: 1px solid var(--border-color);
            transition: 0.3s; z-index: 2000; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }
        .vip-side-panel.active { right: 0; }

        /* æ ¸å¿ƒä¿®æ”¹ï¼šè¡¨æ ¼çª—å£åŒ–å¸ƒå±€ */
        #table-wrapper { 
            height: calc(100vh - 90px); /* ç•™å‡ºä¸Šä¸‹é—´è· */
            max-width: 96%;             /* å®½åº¦ä¸å æ»¡ï¼Œè¥é€ çª—å£æ„Ÿ */
            margin: 20px auto;          /* è‡ªåŠ¨å±…ä¸­ */
            background: #fff; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.08); /* çª—å£é˜´å½± */
            border-radius: 12px;        /* åœ†è§’ */
            overflow: hidden; 
            border: 1px solid var(--border-color);
        }
        
        .tabulator { border: none !important; font-size: 14px; }
        .tabulator-cell { white-space: nowrap !important; border-right: 1px solid #f0f0f0 !important; }
        
        @media (max-width: 600px) {
            .logo { display: none; }
            #table-wrapper { margin: 10px auto; height: calc(100vh - 70px); max-width: 98%; }
        }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="main-controls">
            <span class="logo">WPS LITE</span>
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">å¯¼å…¥</button>
            <input type="file" id="fileInput" hidden accept=".xlsx, .xls, .csv">
            <button class="btn" onclick="table.addRow({}, true)">â• è¡Œ</button>
            <button class="btn" onclick="addColumn()">â• åˆ—</button>
            <button class="btn" onclick="table.download('xlsx', 'wps_export.xlsx')">å¯¼å‡º</button>
        </div>
        <button class="btn btn-vip" onclick="toggleVip()">ğŸ’ VIP å·¥å…·ç®±</button>
    </div>

    <div class="vip-side-panel" id="vipPanel">
        <h3 style="margin-top:0; color: #5d4037;">VIP å°Šäº«åŠŸèƒ½</h3>
        <div class="vip-item" style="margin-bottom:15px;">
            <h4>âœ¨ ä¸€é”®ç¾åŒ–</h4>
            <button class="btn" style="width:100%" onclick="applyVipTheme()">æ™ºèƒ½é…è‰²</button>
        </div>
        <div class="vip-item" style="margin-bottom:15px;">
            <h4>ğŸ§¹ æ•°æ®æ¸…æ´—</h4>
            <button class="btn" style="width:100%" onclick="cleanData()">å»é™¤ç©ºæ ¼</button>
        </div>
        <div class="vip-item" style="margin-bottom:15px;">
            <h4>ğŸ” å¿«é€Ÿæœç´¢</h4>
            <input type="text" id="filter-input" placeholder="è¾“å…¥å…³é”®å­—..." style="width:100%; padding:8px; box-sizing:border-box; border:1px solid #ddd; border-radius:4px;">
        </div>
        <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="toggleVip()">å…³é—­é¢æ¿</button>
    </div>

    <div id="table-wrapper">
        <div id="table-container"></div>
    </div>

<script>
    var table;

    function initTable(data = []) {
        table = new Tabulator("#table-container", {
            data: data,
            // ä¿®æ”¹ä¸º fitColumnsï¼šåœ¨çª—å£å†…è‡ªé€‚åº”å®½åº¦ï¼Œæ›´å…·å°çª—å£æ„Ÿ
            layout: "fitColumns", 
            height: "100%",
            movableColumns: true,
            pagination: "local",
            paginationSize: 50,
            autoColumns: true,
            autoColumnsDefinitions: (defs) => {
                defs.forEach(col => { 
                    col.editor = "input"; 
                    col.headerFilter = "input";
                    col.minWidth = 60; // é™ä½æœ€å°å®½åº¦ï¼Œå…è®¸ç¼©å¾—æ›´ç´§å‡‘
                    col.vertAlign = "middle";
                });
                return defs;
            },
            placeholder: "ç‚¹å‡»ã€å¯¼å…¥ã€‘å¼€å¯å°çª—å£åŠå…¬æ¨¡å¼",
        });

        document.getElementById("filter-input").addEventListener("keyup", function(e){
            const val = e.target.value;
            const columns = table.getColumns();
            if(columns.length > 0) table.setFilter(columns[0].getField(), "like", val);
        });
    }

    document.getElementById('fileInput').onchange = function(e) {
        if (typeof XLSX === 'undefined') return;
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            try {
                const data = new Uint8Array(ev.target.result);
                const wb = XLSX.read(data, {type: 'array', cellDates: true});
                const res = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval: ""});
                initTable(res);
            } catch(err) { alert("è§£æå¤±è´¥"); }
        };
        reader.readAsArrayBuffer(file);
    };

    function toggleVip() { document.getElementById('vipPanel').classList.toggle('active'); }
    function applyVipTheme() {
        document.documentElement.style.setProperty('--primary-color', '#2e7d32');
        table.redraw();
        alert("ä¸»é¢˜åˆ‡æ¢æˆåŠŸ");
    }
    function cleanData() {
        let data = table.getData();
        data.forEach(row => { for(let key in row) if(typeof row[key] === 'string') row[key] = row[key].trim(); });
        table.setData(data);
        alert("æ¸…æ´—å®Œæˆ");
    }
    function addColumn() {
        const name = prompt("åˆ—æ ‡é¢˜ï¼š");
        if(name) table.addColumn({title: name, field: name, editor: "input", headerFilter: "input"});
    }

    initTable([]);
</script>
</body>
</html>
