<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.1, maximum-scale=2.0, user-scalable=yes">
    <title>WPS-WEB å…¨åŠŸèƒ½å·¥ä½œå°</title>
    
    <link href="https://cdn.staticfile.org/tabulator/5.1.0/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/tabulator/5.1.0/js/tabulator.min.js"></script>
    <script src="https://cdn.staticfile.org/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.staticfile.org/PapaParse/5.3.1/papaparse.min.js"></script>
    
    <style>
        :root { --primary-color: #d32f2f; --vip-gold: #ffc107; --bg-color: #ffffff; --border-color: #e0e0e0; }
        
        body, html { height: 100%; margin: 0; padding: 0; font-family: "Segoe UI", system-ui, sans-serif; background: #f4f4f4; overflow: hidden; }

        /* é¡¶éƒ¨å¯¼èˆªæ ï¼šæ¨¡ä»¿ WPS æ‰å¹³åŒ–è®¾è®¡ */
        .app-header { 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; height: 50px; 
            border-bottom: 1px solid var(--border-color); background: var(--bg-color);
            position: sticky; top: 0; z-index: 1000;
        }

        .main-controls { display: flex; align-items: center; gap: 8px; }
        .logo { font-weight: bold; color: var(--primary-color); font-size: 18px; margin-right: 15px; }

        .btn { border: 1px solid var(--border-color); padding: 6px 14px; border-radius: 4px; cursor: pointer; font-size: 13px; background: white; transition: 0.2s; }
        .btn:hover { background: #f0f0f0; }
        .btn-vip { background: var(--vip-gold); border: none; font-weight: bold; color: #5d4037; }
        .btn-primary { background: var(--primary-color); color: white; border: none; }

        /* ä¾§è¾¹åŠŸèƒ½é¢æ¿ */
        .vip-side-panel {
            position: fixed; top: 50px; right: -260px; bottom: 0; width: 250px;
            background: white; border-left: 1px solid var(--border-color);
            transition: 0.3s; z-index: 2000; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }
        .vip-side-panel.active { right: 0; }
        .vip-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
        .vip-item h4 { margin: 0 0 8px 0; font-size: 14px; color: #333; }

        /* è¡¨æ ¼åŒºåŸŸ */
        #table-wrapper { height: calc(100vh - 50px); width: 100%; background: #fff; overflow: auto; }
        .tabulator { border: none !important; }
        .tabulator-cell { white-space: nowrap !important; border-right: 1px solid var(--border-color) !important; }
        
        /* æ‰‹æœºç«¯é€‚é…ï¼šç¡®ä¿æŒ‰é’®ä¸ä¼šæŒ¤åœ¨ä¸€èµ· */
        @media (max-width: 600px) {
            .logo { display: none; }
            .btn { padding: 4px 8px; font-size: 12px; }
        }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="main-controls">
            <span class="logo">WPS LITE</span>
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">å¯¼å…¥</button>
            <input type="file" id="fileInput" hidden accept=".xlsx, .xls, .csv">
            <button class="btn" onclick="table.addRow({}, true)">â• è¡Œ</button>
            <button class="btn" onclick="addColumn()">â• åˆ—</button>
            <button class="btn" onclick="table.download('xlsx', 'wps_export.xlsx')">å¯¼å‡º</button>
        </div>
        <button class="btn btn-vip" onclick="toggleVip()">ğŸ’ VIP å·¥å…·ç®±</button>
    </div>

    <div class="vip-side-panel" id="vipPanel">
        <h3 style="margin-top:0; color: #5d4037;">VIP å°Šäº«åŠŸèƒ½</h3>
        
        <div class="vip-item">
            <h4>âœ¨ ä¸€é”®ç¾åŒ–</h4>
            <button class="btn" style="width:100%" onclick="applyVipTheme()">æ™ºèƒ½é…è‰²æ’ç‰ˆ</button>
        </div>
        
        <div class="vip-item">
            <h4>ğŸ§¹ æ•°æ®æ¸…æ´—</h4>
            <button class="btn" style="width:100%" onclick="cleanData()">å»é™¤ç©ºæ ¼/é‡å¤å€¼</button>
        </div>

        <div class="vip-item">
            <h4>ğŸ” æ·±åº¦ç­›é€‰</h4>
            <input type="text" id="filter-input" placeholder="è¾“å…¥å…³é”®å­—æœç´¢..." style="width:90%; padding:5px; margin-bottom:5px;">
        </div>

        <div class="vip-item">
            <h4>ğŸ”„ æ ¼å¼è½¬æ¢</h4>
            <button class="btn" style="width:100%" onclick="alert('PDF è½¬æ¢å¼•æ“åŠ è½½ä¸­...')">è½¬ä¸º PDF</button>
        </div>

        <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="toggleVip()">å…³é—­é¢æ¿</button>
    </div>

    <div id="table-wrapper">
        <div id="table-container"></div>
    </div>

<script>
    var table;

    // åˆå§‹åŒ–è¡¨æ ¼
    function initTable(data = []) {
        table = new Tabulator("#table-container", {
            data: data,
            layout: "fitDataFill", // åˆå§‹ä¿æŒç´§å‡‘ï¼Œå†…å®¹å¤šæ—¶è‡ªåŠ¨æ¨ªå‘æ’‘å¼€
            height: "100%",
            movableColumns: true,
            pagination: "local",
            paginationSize: 50,
            autoColumns: true,
            autoColumnsDefinitions: (defs) => {
                defs.forEach(col => { 
                    col.editor = "input"; 
                    col.headerFilter = "input";
                    col.minWidth = 100;
                    col.vertAlign = "middle";
                });
                return defs;
            },
            placeholder: "æš‚æ— æ•°æ®ï¼Œè¯·ç‚¹å‡»ã€å¯¼å…¥ã€‘ä¸Šä¼  Excel æ–‡ä»¶",
        });

        // ç»‘å®šæœç´¢åŠŸèƒ½
        document.getElementById("filter-input").addEventListener("keyup", function(e){
            const val = e.target.value;
            // ç®€å•æ¼”ç¤ºï¼šåœ¨æ‰€æœ‰åˆ—æœç´¢
            table.setFilter(table.getColumns()[0].getField(), "like", val);
        });
    }

    // æ–‡ä»¶å¯¼å…¥é€»è¾‘
    document.getElementById('fileInput').onchange = function(e) {
        if (typeof XLSX === 'undefined') {
            alert("é”™è¯¯ï¼šExcel è§£æå¼•æ“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°ç½‘é¡µã€‚");
            return;
        }
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            try {
                const data = new Uint8Array(ev.target.result);
                const wb = XLSX.read(data, {type: 'array', cellDates: true});
                const res = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval: ""});
                initTable(res);
            } catch(err) {
                alert("æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ä¸ºæ ‡å‡† Excel æ ¼å¼ã€‚");
            }
        };
        reader.readAsArrayBuffer(file);
    };

    // VIP åŠŸèƒ½å®ç°
    function toggleVip() { document.getElementById('vipPanel').classList.toggle('active'); }

    function applyVipTheme() {
        // æ¨¡æ‹Ÿ VIP æ™ºèƒ½é…è‰²
        document.documentElement.style.setProperty('--primary-color', '#2e7d32');
        alert("å·²åº”ç”¨ VIP æŠ¤çœ¼å•†åŠ¡ä¸»é¢˜ï¼");
        table.redraw();
    }

    function cleanData() {
        let data = table.getData();
        data.forEach(row => {
            for(let key in row) {
                if(typeof row[key] === 'string') row[key] = row[key].trim();
            }
        });
        table.setData(data);
        alert("VIP æ¸…æ´—å®Œæˆï¼šå·²è‡ªåŠ¨å‰”é™¤æ‰€æœ‰å•å…ƒæ ¼å‰åçš„å¤šä½™ç©ºæ ¼ã€‚");
    }

    function addColumn() {
        const name = prompt("è¯·è¾“å…¥æ–°åˆ—çš„æ ‡é¢˜ï¼š");
        if(name) table.addColumn({title: name, field: name, editor: "input", headerFilter: "input"});
    }

    // é»˜è®¤ç©ºè¡¨å¯åŠ¨
    initTable([]);
</script>
</body>
</html>
