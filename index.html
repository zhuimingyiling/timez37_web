<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.01, maximum-scale=2.0, user-scalable=yes">
    <title>WPS-WEB é«˜çº§ä¿®å¤ç‰ˆ</title>
    
    <link href="https://cdn.staticfile.org/tabulator/5.1.0/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/tabulator/5.1.0/js/tabulator.min.js"></script>
    <script src="https://cdn.staticfile.org/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.staticfile.org/PapaParse/5.3.1/papaparse.min.js"></script>
    
    <style>
        :root { --primary-color: #d32f2f; --vip-gold: #ffc107; --bg-color: #f0f2f5; --border-color: #e0e0e0; }
        
        body, html { height: 100%; margin: 0; padding: 0; font-family: "Segoe UI", system-ui, sans-serif; background: var(--bg-color); overflow: hidden; }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .app-header { 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; height: 50px; 
            border-bottom: 1px solid var(--border-color); background: #ffffff;
            position: sticky; top: 0; z-index: 1000;
        }

        .main-controls { display: flex; align-items: center; gap: 8px; }
        .logo { font-weight: bold; color: var(--primary-color); font-size: 18px; margin-right: 15px; }

        .btn { border: 1px solid var(--border-color); padding: 6px 14px; border-radius: 4px; cursor: pointer; font-size: 13px; background: white; transition: 0.2s; }
        .btn-vip { background: var(--vip-gold); border: none; font-weight: bold; color: #5d4037; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--primary-color); color: white; border: none; }

        /* VIP é«˜æ–¯æ¨¡ç³Šé¢æ¿ */
        .vip-side-panel {
            position: fixed; top: 0; right: -300px; bottom: 0; width: 280px;
            background: rgba(255, 255, 255, 0.75); /* åŠé€æ˜ç™½ */
            backdrop-filter: blur(15px);           /* é«˜æ–¯æ¨¡ç³Šæ ¸å¿ƒ */
            -webkit-backdrop-filter: blur(15px); 
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 2000; padding: 40px 20px; 
            box-shadow: -10px 0 30px rgba(0,0,0,0.05);
        }
        .vip-side-panel.active { right: 0; }
        .vip-item h4 { margin: 20px 0 8px 0; font-size: 14px; color: #333; }

        /* è¡¨æ ¼å°çª—å£å¸ƒå±€ */
        #table-wrapper { 
            height: calc(100vh - 90px); 
            max-width: 96%;             
            margin: 20px auto;          
            background: #fff; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            border-radius: 12px;        
            overflow: hidden; 
            border: 1px solid var(--border-color);
        }
        
        .tabulator { border: none !important; font-size: 14px; }
        .tabulator-cell { white-space: nowrap !important; border-right: 1px solid #f5f5f5 !important; }
        
        @media (max-width: 600px) {
            .logo { display: none; }
            #table-wrapper { margin: 10px auto; height: calc(100vh - 70px); max-width: 98%; }
        }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="main-controls">
            <span class="logo">WPS LITE</span>
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">å¯¼å…¥</button>
            <input type="file" id="fileInput" hidden accept=".xlsx, .xls, .csv">
            <button class="btn" onclick="table.addRow({}, true)">â• è¡Œ</button>
            <button class="btn" onclick="addColumn()">â• åˆ—</button>
            <button class="btn" onclick="table.download('xlsx', 'wps_export.xlsx')">å¯¼å‡º</button>
        </div>
        <button class="btn btn-vip" onclick="toggleVip()">ğŸ’ VIP å·¥å…·ç®±</button>
    </div>

    <div class="vip-side-panel" id="vipPanel">
        <h2 style="margin-top:0; color: #333;">VIP å°Šäº«</h2>
        <div class="vip-item">
            <h4>âœ¨ æ™ºèƒ½é…è‰²</h4>
            <button class="btn" style="width:100%" onclick="applyVipTheme()">ä¸€é”®ç¾åŒ–</button>
        </div>
        <div class="vip-item">
            <h4>ğŸ§¹ æ•°æ®æ¸…æ´—</h4>
            <button class="btn" style="width:100%" onclick="cleanData()">å»é™¤å†—ä½™ç©ºæ ¼</button>
        </div>
        <div class="vip-item">
            <h4>ğŸ” å¿«é€Ÿæœç´¢</h4>
            <input type="text" id="filter-input" placeholder="è¾“å…¥å…³é”®å­—..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; background:rgba(255,255,255,0.5);">
        </div>
        <button class="btn btn-primary" style="width:100%; margin-top:40px;" onclick="toggleVip()">å…³é—­é¢æ¿</button>
    </div>

    <div id="table-wrapper">
        <div id="table-container"></div>
    </div>

<script>
    var table;

    function initTable(data = []) {
        table = new Tabulator("#table-container", {
            data: data,
            layout: "fitColumns", 
            height: "100%",
            movableColumns: true,
            pagination: "local",
            paginationSize: 50,
            autoColumns: true,
            autoColumnsDefinitions: (defs) => {
                defs.forEach(col => { 
                    col.editor = "input"; 
                    col.headerFilter = "input";
                    col.minWidth = 60; 
                    col.vertAlign = "middle";
                });
                return defs;
            },
            placeholder: "ç‚¹å‡»å¯¼å…¥ Excel å¼€å§‹åŠå…¬",
        });

        document.getElementById("filter-input").addEventListener("keyup", function(e){
            const val = e.target.value;
            const columns = table.getColumns();
            if(columns.length > 0) table.setFilter(columns[0].getField(), "like", val);
        });
    }

    document.getElementById('fileInput').onchange = function(e) {
        if (typeof XLSX === 'undefined') return;
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (ev) => {
            try {
                const data = new Uint8Array(ev.target.result);
                // å…³é”®ä¿®å¤ç‚¹ï¼šraw:false å¼ºåˆ¶è¯»å–æ ¼å¼åŒ–åçš„æ–‡æœ¬ï¼ˆå¦‚ç”µè¯å·ç ï¼‰
                const wb = XLSX.read(data, {type: 'array', cellDates: true, cellText: true, raw: false});
                const sheet = wb.Sheets[wb.SheetNames[0]];
                
                // å…³é”®ä¿®å¤ç‚¹ï¼šrange: 2 è‡ªåŠ¨è·³è¿‡å‰ä¸¤è¡Œåˆå¹¶çš„æ ‡é¢˜ï¼Œç›´æ¥è¯»å–æ•°æ®è¡¨å¤´
                const res = XLSX.utils.sheet_to_json(sheet, {defval: "", range: 2});
                
                initTable(res);
            } catch(err) { alert("è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼"); }
        };
        reader.readAsArrayBuffer(file);
    };

    function toggleVip() { document.getElementById('vipPanel').classList.toggle('active'); }
    function applyVipTheme() {
        document.documentElement.style.setProperty('--primary-color', '#1a73e8');
        table.redraw();
        alert("å·²åº”ç”¨ VIP å•†åŠ¡è“ä¸»é¢˜");
    }
    function cleanData() {
        let data = table.getData();
        data.forEach(row => { for(let key in row) if(typeof row[key] === 'string') row[key] = row[key].trim(); });
        table.setData(data);
        alert("æ¸…æ´—å®Œæˆï¼šå·²å‰”é™¤å•å…ƒæ ¼å‰åç©ºæ ¼");
    }
    function addColumn() {
        const name = prompt("åˆ—æ ‡é¢˜ï¼š");
        if(name) table.addColumn({title: name, field: name, editor: "input", headerFilter: "input"});
    }

    initTable([]);
</script>
</body>
</html>
