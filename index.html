<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§è¡¨æ ¼ç¼–è¾‘å™¨ - å®Œç¾è‡ªé€‚åº”ç‰ˆ</title>
    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary-color: #3498db; --bg-color: #f0f2f5; --card-bg: #ffffff; --text-color: #333; }
        [data-theme="dark"] { --bg-color: #1a1a1a; --card-bg: #2d2d2d; --text-color: #eee; }

        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg-color); color: var(--text-color); padding: 15px; margin: 0; transition: 0.3s; }
        .card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 20px; max-width: 1300px; margin: auto; position: relative; }
        
        /* å³ä¸Šè§’è®¾ç½®é¢æ¿ */
        .settings-trigger { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 24px; z-index: 100; transition: transform 0.3s; }
        .settings-trigger:hover { transform: rotate(90deg); }
        .settings-panel { position: absolute; top: 60px; right: 20px; background: var(--card-bg); border: 1px solid #ddd; padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: none; z-index: 101; min-width: 200px; }
        .settings-panel.active { display: block; }
        .setting-item { margin-bottom: 12px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }

        /* ä¸Šä¼ åŒºåŸŸ */
        .drop-zone { border: 2px dashed #ccc; border-radius: 10px; padding: 25px; text-align: center; cursor: pointer; margin-bottom: 20px; }
        .drop-zone:hover { border-color: var(--primary-color); background: rgba(52, 152, 219, 0.05); }

        /* å·¥å…·æ  */
        .toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .btn { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold; transition: 0.2s; }
        .btn-blue { background: var(--primary-color); color: white; }
        .btn-green { background: #27ae60; color: white; }
        .btn-blue:hover, .btn-green:hover { opacity: 0.8; }

        /* è¡¨æ ¼è‡ªé€‚åº”å¾®è°ƒ */
        #table-container { border-radius: 8px; overflow: hidden; border: 1px solid #ddd; width: 100%; }
        .tabulator .tabulator-header .tabulator-col { background-color: var(--primary-color) !important; color: white; font-weight: bold; }
        .tabulator-cell { white-space: pre-wrap !important; word-wrap: break-word !important; } /* å¼ºåˆ¶æ–‡å­—æ¢è¡Œ */
    </style>
</head>
<body data-theme="light">

<div class="card">
    <div class="settings-trigger" onclick="toggleSettings()">âš™ï¸</div>
    <div class="settings-panel" id="settingsPanel">
        <div class="setting-item">
            <span>æ·±è‰²æ¨¡å¼</span>
            <input type="checkbox" onchange="toggleDarkMode(this.checked)">
        </div>
        <div class="setting-item">
            <span>ä¸»é¢˜é¢œè‰²</span>
            <input type="color" value="#3498db" onchange="updateThemeColor(this.value)">
        </div>
        <div class="setting-item">
            <span>å­—ä½“å¤§å°</span>
            <input type="number" value="14" min="10" max="24" style="width: 50px;" onchange="updateFontSize(this.value)">
        </div>
    </div>

    <h2 style="margin-top:0">ğŸ“Š æ™ºèƒ½è‡ªé€‚åº”è¡¨æ ¼ä¸­å¿ƒ</h2>
    
    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
        <strong>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</strong>
        <div style="font-size:12px; color:#888; margin-top:5px;">æ”¯æŒ Excel, CSV, TXT, JSON (æ–‡å­—è‡ªåŠ¨æ¢è¡Œ)</div>
        <input type="file" id="fileInput" hidden accept=".xlsx, .xls, .csv, .txt, .json">
    </div>

    <div class="toolbar">
        <button class="btn btn-blue" onclick="table.addRow({}, true)">â• æ–°è¡Œ</button>
        <button class="btn btn-blue" onclick="addColumn()">â• æ–°åˆ—</button>
        <button class="btn btn-green" onclick="table.download('xlsx', 'å¯¼å‡ºè¡¨æ ¼.xlsx')">ğŸ“¥ å¯¼å‡º Excel</button>
        <button class="btn" onclick="table.clearData()" style="background:#95a5a6; color:white;">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    <div id="table-container"></div>
</div>

<script>
    var table;

    // åˆå§‹åŒ–è¡¨æ ¼ - å¼€å¯è‡ªé€‚åº”å’Œè‡ªåŠ¨æ¢è¡Œ
    function initTable(data = []) {
        table = new Tabulator("#table-container", {
            data: data,
            layout: "fitDataFill", // æ ¸å¿ƒï¼šè‡ªé€‚åº”å†…å®¹ä¸”å¡«æ»¡å®¹å™¨
            pagination: "local",
            paginationSize: 15,
            movableColumns: true,
            resizableColumnFit: true,
            autoColumns: true,
            autoColumnsDefinitions: function(definitions) {
                definitions.forEach((column) => {
                    column.editor = "input";
                    column.headerFilter = "input";
                    column.formatter = "textarea"; // æ ¸å¿ƒï¼šæ–‡å­—æº¢å‡ºè‡ªåŠ¨æ¢è¡Œ
                    column.vertAlign = "middle";
                    column.minWidth = 100;
                });
                return definitions;
            },
            placeholder: "ç­‰å¾…ä¸Šä¼ æ•°æ®...",
        });
    }

    // æ–‡ä»¶å¤„ç†é€»è¾‘
    function handleFile(file) {
        const reader = new FileReader();
        const ext = file.name.split('.').pop().toLowerCase();
        
        reader.onload = (e) => {
            let content;
            if (['xlsx', 'xls'].includes(ext)) {
                const wb = XLSX.read(e.target.result, {type: 'binary'});
                content = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval: ""});
            } else if (ext === 'csv') {
                Papa.parse(e.target.result, {header: true, complete: (res) => initTable(res.data)});
                return;
            }
            initTable(content);
        };

        if (['xlsx', 'xls'].includes(ext)) reader.readAsBinaryString(file);
        else reader.readAsText(file);
    }

    // è®¾ç½®é¢æ¿äº¤äº’
    function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('active'); }
    function toggleDarkMode(isDark) { document.body.setAttribute('data-theme', isDark ? 'dark' : 'light'); }
    function updateThemeColor(color) {
        document.documentElement.style.setProperty('--primary-color', color);
        if(table) {
            document.querySelectorAll(".tabulator-col").forEach(el => el.style.backgroundColor = color);
        }
    }
    function updateFontSize(size) {
        document.getElementById('table-container').style.fontSize = size + "px";
        table.redraw();
    }

    function addColumn() {
        const name = prompt("åˆ—å:");
        if(name) table.addColumn({title: name, field: name, editor: "input", formatter: "textarea"});
    }

    // æ‹–æ‹½æ”¯æŒ
    const zone = document.getElementById('dropZone');
    zone.ondragover = (e) => { e.preventDefault(); zone.style.borderColor = "var(--primary-color)"; };
    zone.ondrop = (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
    document.getElementById('fileInput').onchange = (e) => handleFile(e.target.files[0]);

    initTable([]);
</script>
</body>
</html>
