<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.1, maximum-scale=1.5, user-scalable=yes">
    <title>工作台-视野优化版</title>
    <link href="https://cdn.staticfile.org/tabulator/5.1.0/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/tabulator/5.1.0/js/tabulator.min.js"></script>
    <script src="https://cdn.staticfile.org/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.staticfile.org/PapaParse/5.3.1/papaparse.min.js"></script>
    <style>
        :root { --primary-color: #3498db; --bg-color: #ffffff; --border-color: #e0e0e0; }
        body, html { height: 100%; margin: 0; padding: 0; font-family: system-ui, sans-serif; background: var(--bg-color); }
        .app-header { 
            display: flex; align-items: center; padding: 0 15px; height: 50px; 
            border-bottom: 1px solid var(--border-color); background: var(--bg-color);
            position: sticky; top: 0; z-index: 1000;
        }
        .btn { border: 1px solid var(--border-color); padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; background: white; margin-right: 8px; }
        .btn-primary { background: var(--primary-color); color: white; border: none; }
        
        /* 确保表格容器能平铺，方便缩放 */
        #table-wrapper { height: calc(100vh - 50px); width: 100%; overflow: auto; }
        .tabulator { font-size: 14px; border: none !important; }
        .tabulator-cell { white-space: nowrap !important; border-right: 1px solid var(--border-color) !important; }
    </style>
</head>
<body>
    <div class="app-header">
        <b style="color:var(--primary-color); margin-right:15px;">WORKFLOW</b>
        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">导入</button>
        <input type="file" id="fileInput" hidden accept=".xlsx, .xls, .csv">
        <button class="btn" onclick="table.download('xlsx', 'data.xlsx')">导出</button>
        <span style="font-size:12px; color:#666;">← 双指开合调整视野 →</span>
    </div>

    <div id="table-wrapper"><div id="table-container"></div></div>

<script>
    var table;
    function initTable(data = []) {
        table = new Tabulator("#table-container", {
            data: data,
            // 使用 fitDataFill 可以在数据少时填满，数据多时撑开
            layout: "fitDataFill", 
            height: "100%",
            autoColumns: true,
            autoColumnsDefinitions: (defs) => {
                defs.forEach(col => { 
                    col.editor = "input"; 
                    col.headerFilter = "input";
                    col.minWidth = 80; 
                });
                return defs;
            },
        });
    }

    document.getElementById('fileInput').onchange = function(e) {
        const file = e.target.files[0];
        if(!file || typeof XLSX === 'undefined') return;
        const reader = new FileReader();
        reader.onload = (ev) => {
            const data = new Uint8Array(ev.target.result);
            const wb = XLSX.read(data, {type: 'array'});
            const res = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval: ""});
            initTable(res);
        };
        reader.readAsArrayBuffer(file);
    };

    initTable([]);
</script>
</body>
</html>
